from flask import Blueprint, jsonify, request, current_app
from {{ service_name }}.models import *
from db import db

api_bp = Blueprint('internal_api', __name__)

def get_model_by_name(model_name):
    return globals().get(model_name)

@api_bp.route('/<model_name>/<int:id>', methods=['GET'])
def get_entity(model_name, id):
    model = get_model_by_name(model_name)
    if not model:
        return jsonify({"error": f"Model {model_name} not found"}), 404
    
    entity = model.query.get(id)
    if not entity:
        return jsonify({"error": "Not found"}), 404
    
    data = {}
    for column in entity.__table__.columns:
        data[column.name] = getattr(entity, column.name)
        
    return jsonify(data)

@api_bp.route('/<model_name>/update/<int:id>', methods=['POST'])
def update_entity(model_name, id):
    model = get_model_by_name(model_name)
    if not model:
        return jsonify({"error": "Model not found"}), 404
        
    entity = model.query.get(id)
    if not entity:
        return jsonify({"error": "Not found"}), 404

    data = request.json
    for key, value in data.items():
        if hasattr(entity, key):
            setattr(entity, key, value)
    
    db.session.commit()
    return jsonify({"status": "updated"})
